#!/usr/bin/env node

/**
 * ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ‹¡å……ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
 * ã‚µãƒ–ãƒšãƒ¼ã‚¸ã®ãƒ†ã‚­ã‚¹ãƒˆé‡ã‚’å¢—ã‚„ã™ãŸã‚ã«ã€å„æ¸©æ³‰åœ°ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è‡ªå‹•æ‹¡å……ã—ã¾ã™ã€‚
 * 
 * ä½¿ã„æ–¹: node scripts/enrich-content.js
 */

const fs = require('fs');
const path = require('path');

const themeName = process.env.NEXT_PUBLIC_THEME || 'onsen-kanto';
const contentPath = path.join(__dirname, '..', 'themes', themeName, 'content.json');

// æ¸©æ³‰åœ°å…±é€šã®è¿½åŠ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
const additionalSections = {
  access: (name) => `
### äº¤é€šã‚¢ã‚¯ã‚»ã‚¹è©³ç´°

${name}ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚

#### é›»è»Šã§ãŠè¶Šã—ã®å ´åˆ
- æ±äº¬é§…ã‹ã‚‰ã®æ‰€è¦æ™‚é–“ã¨ä¹—ã‚Šæ›ãˆæ¡ˆå†…
- æ–°å®¿é§…ã‹ã‚‰ã®æ‰€è¦æ™‚é–“ã¨ä¹—ã‚Šæ›ãˆæ¡ˆå†…
- æœ€å¯„ã‚Šé§…ã‹ã‚‰ã®é€è¿ãƒã‚¹æƒ…å ±

#### è»Šã§ãŠè¶Šã—ã®å ´åˆ
- ä¸»è¦ICã‹ã‚‰ã®æ‰€è¦æ™‚é–“
- é§è»Šå ´æƒ…å ±ï¼ˆå°æ•°ãƒ»æ–™é‡‘ï¼‰
- é“è·¯çŠ¶æ³ã¨æ³¨æ„ç‚¹

#### ãŠã™ã™ã‚ã®æ™‚é–“å¸¯
- æ··é›‘ã‚’é¿ã‘ã‚‹ãªã‚‰å¹³æ—¥ã®åˆå‰ä¸­ãŒãŠã™ã™ã‚
- ç´…è‘‰ã‚·ãƒ¼ã‚ºãƒ³ï¼ˆ10æœˆä¸‹æ—¬ã€œ11æœˆä¸­æ—¬ï¼‰ã¯æ—©ã‚ã®åˆ°ç€ã‚’`,

  tips: (name) => `
### æ¸©æ³‰ã‚’æ¥½ã—ã‚€ãŸã‚ã®ãƒ’ãƒ³ãƒˆ

${name}ã‚’ã‚ˆã‚Šæ¥½ã—ã‚€ãŸã‚ã®ãƒã‚¤ãƒ³ãƒˆã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚

#### å…¥æµ´ã®ãƒãƒŠãƒ¼
1. æµ´å®¤ã«å…¥ã‚‹å‰ã«å¿…ãšã‹ã‘æ¹¯ã‚’ã™ã‚‹
2. ã‚¿ã‚ªãƒ«ã¯æ¹¯èˆ¹ã«å…¥ã‚Œãªã„
3. é•·æ¹¯ã¯é¿ã‘ã€é©åº¦ãªæ™‚é–“ã§ä¸ŠãŒã‚‹
4. é£²é…’å¾Œã®å…¥æµ´ã¯æ§ãˆã‚‹

#### æŒã¡ç‰©ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
- ã‚¿ã‚ªãƒ«ï¼ˆãƒ¬ãƒ³ã‚¿ãƒ«ãŒãªã„æ–½è¨­ã‚‚ã‚ã‚Šã¾ã™ï¼‰
- ç€æ›¿ãˆ
- å°éŠ­ï¼ˆãƒ­ãƒƒã‚«ãƒ¼ç”¨ï¼‰
- åŒ–ç²§å“ãƒ»ã‚¹ã‚­ãƒ³ã‚±ã‚¢ç”¨å“
- é˜²æ°´ãƒãƒƒã‚°ï¼ˆè²´é‡å“ç”¨ï¼‰

#### ãŠã™ã™ã‚ã®éã”ã—æ–¹
- åˆ°ç€å¾Œã™ãã®å…¥æµ´ã¯é¿ã‘ã€ã¾ãšã¯æ•£ç­–ã‚’
- é£Ÿäº‹ã¯å…¥æµ´ã®1æ™‚é–“ä»¥ä¸Šå‰ã‹å¾Œã«
- å°±å¯å‰ã®å…¥æµ´ã¯ä½“æ¸©èª¿ç¯€ã«åŠ¹æœçš„`,

  seasons: (name) => `
### å››å­£ã®é­…åŠ›

${name}ã¯å››å­£æŠ˜ã€…ã®è¡¨æƒ…ã‚’è¦‹ã›ã¦ãã‚Œã¾ã™ã€‚

#### æ˜¥ï¼ˆ3æœˆã€œ5æœˆï¼‰
- æ¡œã‚„æ–°ç·‘ãŒç¾ã—ã„å­£ç¯€
- èŠ±ç²‰ç—‡ã®æ–¹ã¯å¯¾ç­–ã‚’
- æ¯”è¼ƒçš„ç©ºã„ã¦ã„ã¦ç©´å ´ã®æ™‚æœŸ

#### å¤ï¼ˆ6æœˆã€œ8æœˆï¼‰
- é¿æš‘åœ°ã¨ã—ã¦äººæ°—
- å·éŠã³ã‚„ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢ã‚‚æ¥½ã—ã‚ã‚‹
- å¤ä¼‘ã¿ã‚·ãƒ¼ã‚ºãƒ³ã¯æ··é›‘ã«æ³¨æ„

#### ç§‹ï¼ˆ9æœˆã€œ11æœˆï¼‰
- ç´…è‘‰ãŒè¦‹é ƒã‚’è¿ãˆã‚‹
- é£Ÿæ¬²ã®ç§‹ã§åœ°å…ƒã‚°ãƒ«ãƒ¡ã‚‚å……å®Ÿ
- äººæ°—ã‚·ãƒ¼ã‚ºãƒ³ã®ãŸã‚æ—©ã‚ã®äºˆç´„ã‚’

#### å†¬ï¼ˆ12æœˆã€œ2æœˆï¼‰
- é›ªè¦‹æ¸©æ³‰ãŒæ¥½ã—ã‚ã‚‹ï¼ˆåœ°åŸŸã«ã‚ˆã‚‹ï¼‰
- ç©ºæ°—ãŒæ¾„ã‚“ã§æ˜Ÿç©ºãŒç¾ã—ã„
- å¹´æœ«å¹´å§‹ã¯ç‰¹ã«æ··é›‘`,

  health: (name) => `
### æ¸©æ³‰ã®åŠ¹èƒ½ã¨å¥åº·åŠ¹æœ

${name}ã®æ¸©æ³‰ãŒã‚‚ãŸã‚‰ã™å¥åº·åŠ¹æœã«ã¤ã„ã¦ã”ç´¹ä»‹ã—ã¾ã™ã€‚

#### ä¸€èˆ¬çš„ãªæ¸©æ³‰ã®åŠ¹èƒ½
- **ä¿æ¸©åŠ¹æœ**: ä½“ã‚’èŠ¯ã‹ã‚‰æ¸©ã‚ã€å†·ãˆæ€§æ”¹å–„ã«
- **ãƒªãƒ©ãƒƒã‚¯ã‚¹åŠ¹æœ**: è‡ªå¾‹ç¥çµŒã‚’æ•´ãˆã€ã‚¹ãƒˆãƒ¬ã‚¹è§£æ¶ˆã«
- **ç¾è‚ŒåŠ¹æœ**: è‚Œã®æ–°é™³ä»£è¬ã‚’ä¿ƒé€²
- **ç–²åŠ´å›å¾©**: è¡€è¡Œä¿ƒé€²ã«ã‚ˆã‚Šç–²ã‚Œã‚’ç™’ã™

#### å…¥æµ´æ™‚ã®æ³¨æ„ç‚¹
- é£Ÿäº‹ç›´å¾Œã‚„é£²é…’å¾Œã®å…¥æµ´ã¯é¿ã‘ã‚‹
- ä¸€å›ã®å…¥æµ´ã¯15ã€œ20åˆ†ç¨‹åº¦ãŒç›®å®‰
- å…¥æµ´å‰å¾Œã«ã¯æ°´åˆ†è£œçµ¦ã‚’
- ä½“èª¿ãŒå„ªã‚Œãªã„æ™‚ã¯ç„¡ç†ã‚’ã—ãªã„

#### ãŠã™ã™ã‚ã®å…¥æµ´æ³•
1. ã¾ãšã¯ã¬ã‚‹ã‚ã®æ¹¯ã§ä½“ã‚’æ…£ã‚‰ã™
2. å¾ã€…ã«æ¸©åº¦ã®é«˜ã„æ¹¯ã¸
3. åŠèº«æµ´ã‚‚å–ã‚Šå…¥ã‚Œã¦ã‚†ã£ãã‚Šã¨
4. æœ€å¾Œã¯è¶³å…ˆã‹ã‚‰å†·æ°´ã‚’ã‹ã‘ã¦è¡€è¡Œä¿ƒé€²`,

  nearby: (name) => `
### å‘¨è¾ºã®è¦³å…‰ã‚¹ãƒãƒƒãƒˆ

${name}å‘¨è¾ºã«ã¯é­…åŠ›çš„ãªè¦³å…‰ã‚¹ãƒãƒƒãƒˆãŒç‚¹åœ¨ã—ã¦ã„ã¾ã™ã€‚

#### è‡ªç„¶ãƒ»æ™¯è¦³
- åœ°å…ƒã®å±±ã‚„æ¸“è°·ã®ãƒã‚¤ã‚­ãƒ³ã‚°ã‚³ãƒ¼ã‚¹
- å­£ç¯€ã®èŠ±ãŒæ¥½ã—ã‚ã‚‹å…¬åœ’
- å±•æœ›å°ã‹ã‚‰ã®ãƒ‘ãƒãƒ©ãƒãƒ“ãƒ¥ãƒ¼

#### æ­´å²ãƒ»æ–‡åŒ–
- åœ°å…ƒã®ç¥ç¤¾ä»é–£
- éƒ·åœŸè³‡æ–™é¤¨ãƒ»åšç‰©é¤¨
- ä¼çµ±å·¥èŠ¸ä½“é¨“

#### ã‚°ãƒ«ãƒ¡ãƒ»ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°
- åœ°å…ƒã®ç‰¹ç”£å“ç›´å£²æ‰€
- è€èˆ—ã®å’Œè“å­åº—
- åœ°å…ƒé£Ÿæã‚’ä½¿ã£ãŸãƒ¬ã‚¹ãƒˆãƒ©ãƒ³

#### ãƒ•ã‚¡ãƒŸãƒªãƒ¼å‘ã‘
- é“ã®é§…ã‚„è¦³å…‰æ–½è¨­
- ä½“é¨“å‹ã‚¢ãƒˆãƒ©ã‚¯ã‚·ãƒ§ãƒ³
- å‹•ç‰©ã¨ãµã‚Œã‚ãˆã‚‹ç‰§å ´`,

  accommodation: (name) => `
### å®¿æ³Šæ–½è¨­ã®ã”æ¡ˆå†…

${name}ã«ã¯æ§˜ã€…ãªã‚¿ã‚¤ãƒ—ã®å®¿æ³Šæ–½è¨­ãŒã‚ã‚Šã¾ã™ã€‚

#### é«˜ç´šæ—…é¤¨
- è€èˆ—ã®ä¼çµ±ã‚ã‚‹æ—…é¤¨
- éƒ¨å±‹ä»˜ãéœ²å¤©é¢¨å‘‚ã®ã‚ã‚‹å®¿
- ä¼šå¸­æ–™ç†ãŒè‡ªæ…¢ã®å®¿

#### ãƒªãƒ¼ã‚ºãƒŠãƒ–ãƒ«ãªå®¿
- æ¸©æ³‰æ°‘å®¿
- ãƒ“ã‚¸ãƒã‚¹ãƒ›ãƒ†ãƒ«
- ãƒšãƒ³ã‚·ãƒ§ãƒ³ãƒ»ãƒ­ãƒƒã‚¸

#### å®¿é¸ã³ã®ãƒã‚¤ãƒ³ãƒˆ
- æºæ³‰ã‹ã‘æµã—ã‹ã©ã†ã‹
- é£Ÿäº‹ã®ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆéƒ¨å±‹é£Ÿãƒ»å€‹å®¤ãƒ»å¤§åºƒé–“ï¼‰
- ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ãƒ»ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆæ™‚é–“
- é€è¿ã‚µãƒ¼ãƒ“ã‚¹ã®æœ‰ç„¡

#### äºˆç´„ã®ã‚³ãƒ„
- äººæ°—ã‚·ãƒ¼ã‚ºãƒ³ã¯2ã€œ3ãƒ¶æœˆå‰ã«äºˆç´„
- ç›´å‰å‰²ã‚„ãƒ—ãƒ©ãƒ³ã‚’æ´»ç”¨ã—ã¦ãŠå¾—ã«
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒãƒªã‚·ãƒ¼ã‚’å¿…ãšç¢ºèª`
};

// ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æ‹¡å……ã™ã‚‹é–¢æ•°
function enrichContent(doc) {
  const name = doc.title.replace(/å®Œå…¨ã‚¬ã‚¤ãƒ‰|ã‚¬ã‚¤ãƒ‰|ã‚¨ãƒªã‚¢/g, '').trim();
  
  // ã™ã§ã«ååˆ†ãªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒã‚ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if (doc.content.length > 2500) {
    console.log(`â­ï¸ ã‚¹ã‚­ãƒƒãƒ—: ${doc.title} (ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é‡: ${doc.content.length}æ–‡å­—)`);
    return doc;
  }

  let enrichedContent = doc.content;

  // è¿½åŠ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠçš„ã«è¿½åŠ 
  const sectionsToAdd = [];

  // ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
  if (!doc.content.includes('ã‚¢ã‚¯ã‚»ã‚¹') && !doc.content.includes('äº¤é€š')) {
    sectionsToAdd.push(additionalSections.access(name));
  }

  // å…¥æµ´ãƒãƒŠãƒ¼ã‚„æŒã¡ç‰©æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
  if (!doc.content.includes('ãƒãƒŠãƒ¼') && !doc.content.includes('æŒã¡ç‰©')) {
    sectionsToAdd.push(additionalSections.tips(name));
  }

  // å››å­£ã®æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
  if (!doc.content.includes('å››å­£') && !doc.content.includes('æ˜¥') && !doc.content.includes('ç´…è‘‰')) {
    sectionsToAdd.push(additionalSections.seasons(name));
  }

  // å¥åº·åŠ¹æœã®æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
  if (!doc.content.includes('åŠ¹èƒ½') || doc.content.length < 1500) {
    sectionsToAdd.push(additionalSections.health(name));
  }

  // å‘¨è¾ºè¦³å…‰æƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
  if (!doc.content.includes('å‘¨è¾º') && !doc.content.includes('è¦³å…‰ã‚¹ãƒãƒƒãƒˆ')) {
    sectionsToAdd.push(additionalSections.nearby(name));
  }

  // å®¿æ³Šæƒ…å ±ãŒãªã„å ´åˆã¯è¿½åŠ 
  if (!doc.content.includes('å®¿æ³Š') && !doc.content.includes('æ—…é¤¨')) {
    sectionsToAdd.push(additionalSections.accommodation(name));
  }

  // è¿½åŠ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’çµåˆ
  if (sectionsToAdd.length > 0) {
    enrichedContent = doc.content + '\n' + sectionsToAdd.join('\n');
    console.log(`âœ… æ‹¡å……: ${doc.title} (${doc.content.length}æ–‡å­— â†’ ${enrichedContent.length}æ–‡å­—)`);
  }

  return {
    ...doc,
    content: enrichedContent
  };
}

// ãƒ¡ã‚¤ãƒ³å‡¦ç†
function main() {
  console.log('ğŸ” ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ‹¡å……ã‚’é–‹å§‹...\n');

  // content.jsonã‚’èª­ã¿è¾¼ã‚€
  if (!fs.existsSync(contentPath)) {
    console.error(`âŒ content.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${contentPath}`);
    process.exit(1);
  }

  const content = JSON.parse(fs.readFileSync(contentPath, 'utf-8'));

  // docsã‚’æ‹¡å……
  if (content.pages?.docs) {
    console.log(`ğŸ“„ ${content.pages.docs.length}ä»¶ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‡¦ç†ã—ã¾ã™\n`);
    
    content.pages.docs = content.pages.docs.map(enrichContent);
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãæˆ»ã™
  fs.writeFileSync(contentPath, JSON.stringify(content, null, 2), 'utf-8');

  console.log('\nâœ… ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ‹¡å……ãŒå®Œäº†ã—ã¾ã—ãŸ');
  console.log(`ğŸ“ æ›´æ–°ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«: ${contentPath}`);
}

main();
