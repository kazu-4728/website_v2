# 画像収集精度向上の改善内容

作成日: 2025年1月

## 問題の概要

**問題**: 既存の画像に温泉がほとんど映っていない

**原因**:
1. 検索キーワードが曖昧（「onsen」「hot spring」だけで判定）
2. フォールバック画像を使用していたため、温泉が写っていない画像も選ばれていた
3. 除外キーワードが不十分（建物、風景、入口などが含まれていた）

## 改善内容

### 1. 必須キーワードの追加

**変更前**: 「onsen」「hot spring」「温泉」などのキーワードがあればOK

**変更後**: 以下のいずれかのキーワードが**必須**：
- `rotenburo`, `rotemburo`, `露天風呂`, `露天` (露天風呂)
- `yubatake`, `湯畑` (湯畑)
- `bath`, `浴場`, `風呂`, `湯船` (浴場・湯船)
- `hot spring`, `onsen`, `温泉` (温泉そのもの)
- `steam`, `湯気`, `蒸気` (湯気 - 温泉の証拠)
- `spring water`, `源泉` (源泉)

### 2. 除外キーワードの強化

**追加した除外キーワード**:
- 建物・施設: `building`, `建物`, `facility`, `施設`, `hotel`, `ryokan`, `旅館`, `宿`, `ホテル`
- 風景・街並み: `view`, `景色`, `landscape`, `風景`, `mountain`, `山`, `lake`, `湖`, `river`, `川`
- 人物・動物: `person`, `人物`, `people`, `人々`
- その他: `map`, `地図`, `sign`, `看板`, `temple`, `shrine`, `寺`, `神社`, `restaurant`, `レストラン`

### 3. 画像優先度システムの導入

画像の優先度を計算して、より確実に温泉が写っている画像を優先：

- **優先度10**: 露天風呂・湯畑などの明確なキーワード
- **優先度8**: 浴場・湯船などのキーワード
- **優先度5**: 湯気・源泉などのキーワード
- **優先度3**: 場所名が含まれている

### 4. フォールバック画像の廃止

**変更前**: 温泉関連の画像が見つからない場合、フォールバック画像を使用

**変更後**: フォールバック画像は使用しない。見つからない場合は`null`を返す

### 5. 検索キーワードの改善

すべての検索キーワードに「rotenburo」「露天風呂」「bath」「浴場」などの、実際に温泉が写っていることを示すキーワードを含めるように変更。

**例**:
- 変更前: `'Hakone Onsen hot spring 温泉'`
- 変更後: `'Hakone Onsen rotenburo 箱根温泉 露天風呂'`

## 改善効果

### 期待される効果

1. **精度の向上**: 温泉が実際に写っている画像のみが選ばれる
2. **品質の向上**: より適切な画像が選ばれる
3. **一貫性の向上**: すべての画像が温泉を写している

### 注意点

1. **取得できない画像が増える可能性**: より厳格な条件のため、一部の温泉地で画像が見つからない可能性がある
2. **手動での追加が必要**: 見つからない場合は、手動で適切な画像を追加する必要がある

## 使用方法

### 1. スクリプトを実行

```bash
node scripts/fetch-wikimedia-images.js
```

### 2. 結果を確認

- 取得できた画像: `✓ Found: [画像タイトル]`
- 取得できなかった画像: `✗ No suitable onsen image found`

### 3. 取得できなかった画像の対処

1. Wikimedia Commonsで手動で検索
2. 適切な画像を見つける
3. `data/wikimedia-images.json`に手動で追加

## 今後の改善案

### 1. 画像の品質チェック機能

- 画像の解像度チェック
- 画像のアスペクト比チェック
- 画像のファイルサイズチェック

### 2. 複数画像の取得

- 各温泉地に複数の画像候補を取得
- 最も適切な画像を自動選択

### 3. 画像の自動検証

- 取得した画像が実際に温泉を写しているか確認
- 不適切な画像を自動的に除外

## 参考

- [Wikimedia Commons API](https://www.mediawiki.org/wiki/API:Main_page)
- [画像取得ガイド](./IMAGE_FETCH_GUIDE.md)
- [画像問題の診断](./IMAGE_ISSUE_DIAGNOSIS.md)
