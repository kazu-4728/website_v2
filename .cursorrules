# Cursor Rules for Code Voyage

## 🚨 作業を開始する前に必ず確認すること

**重要**: このリポジトリで作業を開始する前に、**必ず最初に以下を確認してください**：

1. **[`docs/agent/AGENT_GUIDE.md`](./docs/agent/AGENT_GUIDE.md)** を最初に読んでください
   - エージェント向けの包括的なガイドです
   - **このファイルを参照せずに作業を開始しないでください**

2. **[`docs/agent/START_HERE.md`](./docs/agent/START_HERE.md)** を読んでください
   - 作業開始時の必須確認事項が記載されています

2. **[`docs/FUTURE_TASKS.md`](./docs/FUTURE_TASKS.md)** で今後の課題を確認してください
   - 現在の課題と優先度が記載されています
   - 作業の方向性を理解するために必須です

3. **[`CONTRIBUTING.md`](./CONTRIBUTING.md)** で作業フローを確認してください
   - コントリビューションガイドラインが記載されています

## 📋 作業フロー

1. **課題の確認**
   - `docs/FUTURE_TASKS.md` を開く
   - 作業する課題を選択（優先度を考慮）
   - 関連するドキュメントを確認

2. **環境の準備**
   - `npm install` で依存関係をインストール
   - `npm run dev` でローカル開発サーバーを起動

3. **作業の実施**
   - 小さな変更から始める
   - テストを実行して確認（`npm run test:images`）
   - ビルドが成功することを確認（`npm run build`）

4. **コミットとプッシュ**
   - 変更内容を明確にコミット
   - プッシュ前にビルドが成功することを確認

## 🎯 優先度の理解

`docs/FUTURE_TASKS.md` では、課題が以下の優先度で分類されています：

- **🔴 高優先度**: サイトの信頼性に直結する重要な課題
- **🟡 中優先度**: ユーザー体験やパフォーマンスに影響する課題
- **🟢 低優先度**: サイトの価値向上や開発効率向上に関する課題

作業を開始する際は、優先度の高い課題から取り組むことを推奨します。

## 🔧 技術スタック

- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **アニメーション**: Framer Motion
- **テスト**: Vitest
- **デプロイ**: GitHub Pages (静的エクスポート)

## 📁 重要なファイル

### エージェント向けガイド（最優先）
- `docs/AGENT_GUIDE.md` - **エージェント向けガイド（必読）**
- `docs/START_HERE.md` - **作業開始時の必須確認事項（最優先）**
- `docs/FUTURE_TASKS.md` - **今後の課題一覧（必須）**

### 設計ドキュメント
- `docs/design/DESIGN_CONCEPTION_V4.md` - **設計構想（最新版）**
- `docs/design/DESIGN_CONCEPTION_SUMMARY.md` - **設計構想サマリー**
- `docs/design/UI_DESIGN_V3.md` - UI設計書
- `docs/design/REVIEW_SITE_CURRENT.md` - 現状分析レポート

### 画像システム
- `docs/images/MULTI_API_IMAGE_FETCH.md` - **画像取得システムガイド**
- `docs/images/IMAGE_FETCH_RECOMMENDATIONS.md` - 画像取得推奨事項
- `data/wikimedia-images.json` - **取得した画像のリスト（ユーザー確認用）**
- `scripts/fetch-onsen-images-multi-api.js` - **画像取得スクリプト**

### アーキテクチャ
- `docs/architecture/MASTER_ARCHITECTURE.md` - アーキテクチャの詳細
- `app/lib/content.ts` - コンテンツ管理システム
- `app/lib/images.ts` - 画像管理システム

### コンテンツ（JSON First）
- `themes/onsen-kanto/content.json` - サイトのコンテンツ設定
- `themes/onsen-kanto/texts.json` - **画面テキストの一元管理（重要）**

### その他
- `CONTRIBUTING.md` - コントリビューションガイド

## 📊 現在の状態（2025年12月時点）

### JSON First アーキテクチャの完成

このリポジトリは、**JSON First アーキテクチャ**が完全に実装されています：

- **画面テキストの一元管理**: すべてのユーザー向けテキストは `themes/onsen-kanto/texts.json` で管理されています
  - `nav`: ナビゲーション・バックリンク・ページネーション
  - `pages`: ページタイトル・説明文
  - `buttons`: ボタンラベル（詳しく見る、Read Story、Learn more、送信するなど）
  - `form`: フォームラベル・プレースホルダー
  - `messages`: エラーメッセージ・not found メッセージ
  - `ui`: UIラベル（Table of Contents、Documentation、Ready to Deploy? など）

- **型安全性の確保**: `app/lib/content.ts` の `ContentConfig` / `TextsConfig` インターフェースが `texts.json` の構造と完全に整合しています
  - `loadContent()` 関数が自動的に `texts.json` を読み込み、`content.texts` として提供
  - すべてのコンポーネントで `const texts = content.texts;` としてアクセス可能

- **ビルド・リントの安定性**: `npm run build` / `npm run lint` は常に通る状態を前提としています
  - 型エラーは許容されません
  - ビルドエラーは即座に修正が必要です

## ⚠️ 注意事項

1. **画像の取得と使用について（最重要）**
   - 画像取得スクリプトで取得した画像は、**自動的にサイトに反映しません**
   - 取得した画像は`data/wikimedia-images.json`に保存されますが、**ユーザーが確認して使用を判断します**
   - エージェントは画像を取得するだけで、**勝手にサイトに反映しないでください**
   - 取得した画像のURLをリストアップし、ユーザーに報告してください
   - ユーザーの承認を得てから、サイトに反映してください
   - 詳細は `docs/AGENT_GUIDE.md` を参照

2. **画像の最適化**: GitHub Pagesの静的エクスポートでは画像最適化が無効（`unoptimized: true`）
3. **テスト**: 一部のテストが失敗している可能性がある（`SKIP_CHECK=true`でスキップ可能）
4. **画像取得システム**: 
   - 複数の無料画像APIを統合した画像取得システムを実装済み（`scripts/fetch-onsen-images-multi-api.js`）
   - Wikimedia Commons APIはAPIキー不要だが、レート制限に注意
   - Pixabay、Pexels、UnsplashはAPIキーが必要（環境変数で設定）
   - 詳細は `docs/images/MULTI_API_IMAGE_FETCH.md` を参照
5. **ビルド**: 静的エクスポートを使用しているため、サーバーサイド機能は使用できない
6. **APIキーの管理**: APIキーは環境変数で管理し、絶対にコミット・ログ出力しないこと

## 🔒 編集可能なレイヤー / 編集禁止レイヤー

### ✅ 編集可能（OK）

以下のファイル・ディレクトリは、作業内容に応じて自由に編集できます：

- **`app/` 配下のページ・コンポーネント**
  - `app/*/page.tsx` - 各ページコンポーネント
  - `app/components/` - 再利用可能なコンポーネント
  - テキストの表示は必ず `content.texts` から取得すること

- **`app/lib/content.ts`**
  - 型定義（`TextsConfig`、`ContentConfig` など）の微修正
  - `loadContent()` 関数の改善
  - `texts.json` の新しいキーに対応する型の追加

- **`themes/onsen-kanto/texts.json`**
  - 文言の変更・追加
  - 新しいキーの追加（対応する型定義も `app/lib/content.ts` に追加すること）

### ❌ 原則編集禁止（NG）

以下のファイル・ディレクトリは、**特別な理由がない限り編集しないでください**：

- **`.github/workflows/` 配下**
  - CI/CD パイプラインの設定
  - 変更する場合は、デプロイフローへの影響を十分に検討すること

- **`package.json` / `package-lock.json` / `pnpm-lock.yaml` などロックファイル**
  - 依存関係の変更は慎重に
  - 変更する場合は、ビルド・テストが通ることを必ず確認

- **`next.config.*` / `tsconfig.*`**
  - Next.js / TypeScript の設定ファイル
  - 変更する場合は、ビルド・デプロイへの影響を確認

- **`scripts/` 配下**
  - ビルドスクリプト・自動生成スクリプト
  - 変更する場合は、既存のワークフローへの影響を確認

## ✅ チェックリスト

作業を開始する前に、以下を確認してください：

- [ ] `docs/agent/AGENT_GUIDE.md` を読みました
- [ ] `docs/agent/START_HERE.md` を読みました
- [ ] `docs/FUTURE_TASKS.md` を読みました
- [ ] `docs/architecture/MASTER_ARCHITECTURE.md` を読みました
- [ ] 作業する課題を選択しました
- [ ] 関連するドキュメントを確認しました
- [ ] 環境の準備が完了しました

**すべてチェックが完了したら、作業を開始してください！**

## 🗺️ 今後のタスク方針

リポジトリの改善は、以下の3つのフェーズに分けて進めます：

### フェーズA：技術的負債の掃除

**目的**: コードベースの健全性を向上させ、保守性を高める

- **未使用コンポーネントの整理**
  - 使用されていないコンポーネントの特定と削除
  - 重複コードの統合

- **不要ルートの整理**
  - 実際に使用されていないページルートの削除
  - ルーティング構造の最適化

- **sitemap との整合性確保**
  - `app/sitemap.ts` と実際のルートの整合性確認
  - 不要なエントリの削除

### フェーズB：UI/UX 調整

**目的**: ユーザー体験の向上とアクセシビリティの確保

- **モバイル表示の最適化**
  - レスポンシブデザインの見直し
  - モバイルファーストの改善

- **アクセシビリティの向上**
  - ARIA ラベルの適切な設定
  - キーボードナビゲーションの改善
  - コントラスト比の確認

- **ラベル統一**
  - `texts.json` のラベル命名規則の統一
  - 一貫性のある UI テキストの使用

### フェーズC：機能拡張

**目的**: サイトの価値向上と新機能の追加

- **温泉検索・絞り込み機能**
  - 地域・効能・アクセス方法での検索
  - フィルタリング機能の実装

- **マップ機能**
  - 温泉地の位置情報表示
  - インタラクティブマップの統合

- **その他の機能拡張**
  - ユーザーフィードバックに基づく機能追加
  - パフォーマンス最適化

**注意**: 各フェーズは順次進めることを推奨しますが、緊急度の高い課題は優先的に対応してください。
